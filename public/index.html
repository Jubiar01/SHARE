<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShareBoost - Facebook Post Sharing Tool</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        sable: '#060606',
                    },
                    fontFamily: {
                        'roboto': ['Roboto', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #060606;
            font-family: 'Roboto', sans-serif;
            color: #ffffff;
        }
        
        /* Material Design Elevation Shadows */
        .elevation-1 {
            box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
        }
        .elevation-2 {
            box-shadow: 0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23);
        }
        .elevation-3 {
            box-shadow: 0 10px 20px rgba(0,0,0,0.19), 0 6px 6px rgba(0,0,0,0.23);
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes fadeOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .animate-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }
        
        .animate-slide-in {
            animation: slideIn 0.3s ease-out forwards;
        }
        
        .animate-fade-out {
            animation: fadeOut 0.3s ease-out forwards;
        }
        
        .loader {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #ffffff;
            animation: spin 1s ease infinite;
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Toast Notifications Container -->
    <div id="toasts" class="fixed bottom-5 right-5 z-50 flex flex-col gap-3 max-w-sm"></div>

    <!-- Header -->
    <header class="sticky top-0 z-40 bg-sable elevation-2">
        <div class="max-w-6xl mx-auto px-4">
            <div class="flex items-center justify-between h-16">
                <!-- Logo -->
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 flex items-center justify-center bg-[#0c0c0c] rounded-md elevation-1">
                        <i class="ph-fill ph-share-network text-xl text-[#4d6dd3]"></i>
                    </div>
                    <span class="text-xl font-bold">ShareBoost</span>
                </div>
                
                <!-- Mobile Menu Toggle -->
                <button id="menuToggle" class="md:hidden w-10 h-10 flex items-center justify-center bg-[#0c0c0c] rounded-md elevation-1">
                    <i class="ph-fill ph-list text-xl"></i>
                </button>
                
                <!-- Navigation -->
                <nav class="hidden md:block">
                    <ul id="navMenu" class="flex gap-6">
                        <li>
                            <a href="#" class="flex items-center gap-2 py-2 px-1 text-white border-b-2 border-[#4d6dd3]" data-tab="dashboard">
                                <div class="w-10 h-10 flex items-center justify-center bg-[#0c0c0c] rounded-md elevation-1">
                                    <i class="ph-fill ph-chart-bar text-[#4d6dd3]"></i>
                                </div>
                                <span>Dashboard</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="flex items-center gap-2 py-2 px-1 text-[#a0a0a0] border-b-2 border-transparent hover:text-white" data-tab="new-session">
                                <div class="w-10 h-10 flex items-center justify-center bg-[#0c0c0c] rounded-md elevation-1">
                                    <i class="ph-fill ph-plus"></i>
                                </div>
                                <span>New Session</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="flex items-center gap-2 py-2 px-1 text-[#a0a0a0] border-b-2 border-transparent hover:text-white" data-tab="history">
                                <div class="w-10 h-10 flex items-center justify-center bg-[#0c0c0c] rounded-md elevation-1">
                                    <i class="ph-fill ph-clock-counter-clockwise"></i>
                                </div>
                                <span>History</span>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
            
            <!-- Mobile Navigation Menu -->
            <div id="mobileMenu" class="md:hidden hidden" style="animation: fadeIn 0.3s ease-out forwards;">
                <ul class="py-3 border-t border-[#2a2a2a]">
                    <li class="py-2">
                        <a href="#" class="flex items-center gap-2 px-1 hover:text-[#4d6dd3]" data-tab="dashboard">
                            <div class="w-10 h-10 flex items-center justify-center bg-[#0c0c0c] rounded-md elevation-1">
                                <i class="ph-fill ph-chart-bar"></i>
                            </div>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li class="py-2">
                        <a href="#" class="flex items-center gap-2 px-1 hover:text-[#4d6dd3]" data-tab="new-session">
                            <div class="w-10 h-10 flex items-center justify-center bg-[#0c0c0c] rounded-md elevation-1">
                                <i class="ph-fill ph-plus"></i>
                            </div>
                            <span>New Session</span>
                        </a>
                    </li>
                    <li class="py-2">
                        <a href="#" class="flex items-center gap-2 px-1 hover:text-[#4d6dd3]" data-tab="history">
                            <div class="w-10 h-10 flex items-center justify-center bg-[#0c0c0c] rounded-md elevation-1">
                                <i class="ph-fill ph-clock-counter-clockwise"></i>
                            </div>
                            <span>History</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-6xl mx-auto px-4 py-6">
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content">
            <!-- Stats Grid -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                <!-- Active Sessions Stat -->
                <div class="bg-sable rounded-lg p-4 border border-[#2a2a2a] flex items-center gap-4 elevation-2">
                    <div class="w-12 h-12 flex items-center justify-center bg-[#0c0c0c] rounded-md elevation-1">
                        <i class="ph-fill ph-activity text-xl text-[#4d6dd3]"></i>
                    </div>
                    <div>
                        <div id="activeSessionsCount" class="text-3xl font-bold">0</div>
                        <div class="text-[#a0a0a0] text-sm">Active Sessions</div>
                    </div>
                </div>
                
                <!-- Total Shares Stat -->
                <div class="bg-sable rounded-lg p-4 border border-[#2a2a2a] flex items-center gap-4 elevation-2">
                    <div class="w-12 h-12 flex items-center justify-center bg-[#0c0c0c] rounded-md elevation-1">
                        <i class="ph-fill ph-share-network text-xl text-[#4d6dd3]"></i>
                    </div>
                    <div>
                        <div id="totalSharesCount" class="text-3xl font-bold">0</div>
                        <div class="text-[#a0a0a0] text-sm">Total Shares</div>
                    </div>
                </div>
                
                <!-- Completed Sessions Stat -->
                <div class="bg-sable rounded-lg p-4 border border-[#2a2a2a] flex items-center gap-4 elevation-2">
                    <div class="w-12 h-12 flex items-center justify-center bg-[#0c0c0c] rounded-md elevation-1">
                        <i class="ph-fill ph-check-circle text-xl text-[#48c774]"></i>
                    </div>
                    <div>
                        <div id="completedSessionsCount" class="text-3xl font-bold">0</div>
                        <div class="text-[#a0a0a0] text-sm">Completed Sessions</div>
                    </div>
                </div>
                
                <!-- Error Sessions Stat -->
                <div class="bg-sable rounded-lg p-4 border border-[#2a2a2a] flex items-center gap-4 elevation-2">
                    <div class="w-12 h-12 flex items-center justify-center bg-[#0c0c0c] rounded-md elevation-1">
                        <i class="ph-fill ph-warning-circle text-xl text-[#f14668]"></i>
                    </div>
                    <div>
                        <div id="errorSessionsCount" class="text-3xl font-bold">0</div>
                        <div class="text-[#a0a0a0] text-sm">Sessions With Errors</div>
                    </div>
                </div>
            </div>
            
            <!-- Active Sessions Card -->
            <div class="bg-sable rounded-lg p-6 border border-[#2a2a2a] mb-6 elevation-2">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="flex items-center gap-3 text-xl font-medium">
                        <div class="w-10 h-10 flex items-center justify-center bg-[#0c0c0c] rounded-md elevation-1">
                            <i class="ph-fill ph-activity text-[#4d6dd3]"></i>
                        </div>
                        Active Sessions
                    </h2>
                </div>
                
                <!-- Search and Refresh -->
                <div class="flex flex-col sm:flex-row gap-3 mb-6">
                    <div class="relative flex-grow">
                        <i class="ph-fill ph-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-[#606060]"></i>
                        <input type="text" id="sessionSearch" placeholder="Search sessions by URL or Post ID..." 
                               class="w-full pl-10 pr-3 py-3 bg-[#0c0c0c] border border-[#2a2a2a] rounded-md text-white focus:outline-none focus:border-[#4d6dd3] transition-colors">
                    </div>
                    <button id="refreshSessions" class="flex items-center justify-center gap-2 px-4 py-3 bg-transparent border border-[#2a2a2a] rounded-md text-[#a0a0a0] hover:text-white hover:border-white transition-colors elevation-1">
                        <i class="ph-fill ph-arrows-clockwise"></i>
                        Refresh
                    </button>
                </div>
                
                <!-- Sessions Table -->
                <div id="activeSessionsTable">
                    <!-- Empty State -->
                    <div id="noSessionsMessage" class="flex flex-col items-center justify-center py-12 text-center">
                        <div class="w-16 h-16 flex items-center justify-center bg-[#0c0c0c] rounded-full mb-6 elevation-1">
                            <i class="ph-fill ph-database text-2xl text-[#606060]"></i>
                        </div>
                        <p class="text-[#a0a0a0] mb-6">No active sessions found</p>
                        <button id="createFirstSession" class="flex items-center justify-center gap-2 px-4 py-3 bg-[#4d6dd3] text-white rounded-md font-medium elevation-1 hover:bg-[#3d5bc0] transition-colors">
                            <i class="ph-fill ph-plus-circle"></i>
                            Create your first sharing session
                        </button>
                    </div>
                    
                    <!-- Sessions Table -->
                    <div id="sessionsTableContainer" class="hidden overflow-x-auto">
                        <table id="sessionsTable" class="w-full border-collapse">
                            <thead>
                                <tr>
                                    <th class="px-3 py-3 text-left text-[#a0a0a0] font-medium border-b border-[#2a2a2a]">Facebook Post</th>
                                    <th class="px-3 py-3 text-left text-[#a0a0a0] font-medium border-b border-[#2a2a2a]">Progress</th>
                                    <th class="px-3 py-3 text-left text-[#a0a0a0] font-medium border-b border-[#2a2a2a]">Status</th>
                                    <th class="px-3 py-3 text-left text-[#a0a0a0] font-medium border-b border-[#2a2a2a]">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="sessionsTableBody">
                                <!-- Sessions will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Session Details Panel -->
            <div id="sessionDetails" class="bg-sable rounded-lg p-6 border border-[#2a2a2a] mb-6 elevation-3 hidden">
                <h3 class="text-lg font-medium mb-4">Session Details</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <div class="text-[#a0a0a0] mb-1">Session ID:</div>
                        <div id="detailSessionId" class="font-medium break-all"></div>
                    </div>
                    
                    <div>
                        <div class="text-[#a0a0a0] mb-1">Status:</div>
                        <div id="detailStatus"></div>
                    </div>
                    
                    <div class="md:col-span-2">
                        <div class="text-[#a0a0a0] mb-1">Post URL:</div>
                        <div id="detailUrl" class="font-medium break-all"></div>
                    </div>
                    
                    <div>
                        <div class="text-[#a0a0a0] mb-1">Post ID:</div>
                        <div id="detailPostId" class="font-medium"></div>
                    </div>
                    
                    <div>
                        <div class="text-[#a0a0a0] mb-1">Progress:</div>
                        <div id="detailProgress" class="font-medium"></div>
                    </div>
                    
                    <div>
                        <div class="text-[#a0a0a0] mb-1">Start Time:</div>
                        <div id="detailStartTime" class="font-medium"></div>
                    </div>
                    
                    <div>
                        <div class="text-[#a0a0a0] mb-1">Expected End Time:</div>
                        <div id="detailEndTime" class="font-medium"></div>
                    </div>
                </div>
                
                <div class="flex flex-col sm:flex-row gap-3 mt-6">
                    <button id="stopSessionBtn" class="flex items-center justify-center gap-2 px-4 py-3 bg-[#f14668] text-white rounded-md font-medium elevation-1 hover:opacity-90 transition-opacity">
                        <i class="ph-fill ph-stop-circle"></i>
                        Stop Session
                    </button>
                    <button id="closeDetailBtn" class="flex items-center justify-center gap-2 px-4 py-3 bg-transparent border border-[#2a2a2a] rounded-md text-[#a0a0a0] hover:text-white hover:border-white transition-colors elevation-1">
                        <i class="ph-fill ph-x"></i>
                        Close
                    </button>
                </div>
            </div>
        </div>

        <!-- New Session Tab -->
        <div id="new-session" class="tab-content hidden">
            <div class="bg-sable rounded-lg p-6 border border-[#2a2a2a] mb-6 elevation-2">
                <div class="flex items-center gap-3 mb-6">
                    <div class="w-10 h-10 flex items-center justify-center bg-[#0c0c0c] rounded-md elevation-1">
                        <i class="ph-fill ph-plus-circle text-[#4d6dd3]"></i>
                    </div>
                    <h2 class="text-xl font-medium">Start New Share Session</h2>
                </div>
                
                <form id="shareForm">
                    <div class="mb-4">
                        <label for="fbUrl" class="block mb-2 text-[#a0a0a0] font-medium">Facebook Post URL</label>
                        <input type="url" id="fbUrl" placeholder="https://www.facebook.com/..." 
                               class="w-full px-4 py-3 bg-[#0c0c0c] border border-[#2a2a2a] rounded-md text-white focus:outline-none focus:border-[#4d6dd3] transition-colors"
                               required>
                    </div>
                    
                    <div class="mb-4">
                        <label for="fbCookie" class="block mb-2 text-[#a0a0a0] font-medium">Facebook Cookies (JSON format)</label>
                        <textarea id="fbCookie" rows="6" placeholder='[{"key": "sb", "value": "..."}, {"key": "c_user", "value": "..."}, ...]'
                                  class="w-full px-4 py-3 bg-[#0c0c0c] border border-[#2a2a2a] rounded-md text-white focus:outline-none focus:border-[#4d6dd3] transition-colors"
                                  required></textarea>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div>
                            <label for="shareAmount" class="block mb-2 text-[#a0a0a0] font-medium">Number of Shares</label>
                            <input type="number" id="shareAmount" min="1" max="1000" value="50"
                                   class="w-full px-4 py-3 bg-[#0c0c0c] border border-[#2a2a2a] rounded-md text-white focus:outline-none focus:border-[#4d6dd3] transition-colors"
                                   required>
                        </div>
                        
                        <div>
                            <label for="shareInterval" class="block mb-2 text-[#a0a0a0] font-medium">Interval Between Shares (seconds)</label>
                            <input type="number" id="shareInterval" min="5" max="600" value="30"
                                   class="w-full px-4 py-3 bg-[#0c0c0c] border border-[#2a2a2a] rounded-md text-white focus:outline-none focus:border-[#4d6dd3] transition-colors"
                                   required>
                        </div>
                    </div>
                    
                    <div class="flex flex-col sm:flex-row gap-3">
                        <button type="submit" id="startSharingBtn" class="flex items-center justify-center gap-2 px-4 py-3 bg-[#4d6dd3] text-white rounded-md font-medium elevation-1 hover:bg-[#3d5bc0] transition-colors">
                            <i class="ph-fill ph-play"></i>
                            Start Sharing
                        </button>
                        <button type="reset" class="flex items-center justify-center gap-2 px-4 py-3 bg-transparent border border-[#2a2a2a] rounded-md text-[#a0a0a0] hover:text-white hover:border-white transition-colors elevation-1">
                            <i class="ph-fill ph-x"></i>
                            Clear Form
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- History Tab -->
        <div id="history" class="tab-content hidden">
            <div class="bg-sable rounded-lg p-6 border border-[#2a2a2a] mb-6 elevation-2">
                <div class="flex items-center gap-3 mb-6">
                    <div class="w-10 h-10 flex items-center justify-center bg-[#0c0c0c] rounded-md elevation-1">
                        <i class="ph-fill ph-clock-counter-clockwise text-[#4d6dd3]"></i>
                    </div>
                    <h2 class="text-xl font-medium">Session History</h2>
                </div>
                
                <div class="flex flex-col sm:flex-row gap-3 mb-6">
                    <div class="relative flex-grow">
                        <i class="ph-fill ph-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-[#606060]"></i>
                        <input type="text" id="historySearch" placeholder="Search by URL or Post ID..." 
                               class="w-full pl-10 pr-3 py-3 bg-[#0c0c0c] border border-[#2a2a2a] rounded-md text-white focus:outline-none focus:border-[#4d6dd3] transition-colors">
                    </div>
                    <button id="searchHistoryBtn" class="flex items-center justify-center gap-2 px-4 py-3 bg-[#4d6dd3] text-white rounded-md font-medium elevation-1 hover:bg-[#3d5bc0] transition-colors">
                        <i class="ph-fill ph-magnifying-glass"></i>
                        Search
                    </button>
                </div>
                
                <div id="historyResults">
                    <div class="flex flex-col items-center justify-center py-12 text-center">
                        <div class="w-16 h-16 flex items-center justify-center bg-[#0c0c0c] rounded-full mb-6 elevation-1">
                            <i class="ph-fill ph-clock-counter-clockwise text-2xl text-[#606060]"></i>
                        </div>
                        <p class="text-[#a0a0a0]">No session history found</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // DOM Elements
        const elements = {
            // Navigation
            navLinks: document.querySelectorAll('[data-tab]'),
            tabContents: document.querySelectorAll('.tab-content'),
            menuToggle: document.getElementById('menuToggle'),
            mobileMenu: document.getElementById('mobileMenu'),
            
            // Dashboard
            activeSessionsCount: document.getElementById('activeSessionsCount'),
            totalSharesCount: document.getElementById('totalSharesCount'),
            completedSessionsCount: document.getElementById('completedSessionsCount'),
            errorSessionsCount: document.getElementById('errorSessionsCount'),
            sessionsTableContainer: document.getElementById('sessionsTableContainer'),
            sessionsTable: document.getElementById('sessionsTable'),
            sessionsTableBody: document.getElementById('sessionsTableBody'),
            noSessionsMessage: document.getElementById('noSessionsMessage'),
            sessionSearch: document.getElementById('sessionSearch'),
            refreshSessions: document.getElementById('refreshSessions'),
            createFirstSession: document.getElementById('createFirstSession'),
            
            // Session Details
            sessionDetails: document.getElementById('sessionDetails'),
            detailSessionId: document.getElementById('detailSessionId'),
            detailUrl: document.getElementById('detailUrl'),
            detailPostId: document.getElementById('detailPostId'),
            detailStartTime: document.getElementById('detailStartTime'),
            detailEndTime: document.getElementById('detailEndTime'),
            detailStatus: document.getElementById('detailStatus'),
            detailProgress: document.getElementById('detailProgress'),
            stopSessionBtn: document.getElementById('stopSessionBtn'),
            closeDetailBtn: document.getElementById('closeDetailBtn'),
            
            // New Session
            shareForm: document.getElementById('shareForm'),
            fbUrl: document.getElementById('fbUrl'),
            fbCookie: document.getElementById('fbCookie'),
            shareAmount: document.getElementById('shareAmount'),
            shareInterval: document.getElementById('shareInterval'),
            startSharingBtn: document.getElementById('startSharingBtn'),
            
            // History
            historySearch: document.getElementById('historySearch'),
            searchHistoryBtn: document.getElementById('searchHistoryBtn'),
            historyResults: document.getElementById('historyResults'),
            
            // Toast container
            toasts: document.getElementById('toasts')
        };

        // State management
        const state = {
            activeSessions: [],
            selectedSessionId: null,
            refreshInterval: null,
            isLoading: false
        };

        // Tab navigation
        function activateTab(tabId) {
            // Update nav links
            elements.navLinks.forEach(link => {
                const isActive = link.getAttribute('data-tab') === tabId;
                
                // Desktop nav
                if (isActive) {
                    link.classList.add('text-white');
                    link.classList.add('border-[#4d6dd3]');
                    link.classList.remove('text-[#a0a0a0]');
                    link.classList.remove('border-transparent');
                } else {
                    link.classList.remove('text-white');
                    link.classList.remove('border-[#4d6dd3]');
                    link.classList.add('text-[#a0a0a0]');
                    link.classList.add('border-transparent');
                }
            });
            
            // Update tab content
            elements.tabContents.forEach(content => {
                if (content.id === tabId) {
                    content.classList.remove('hidden');
                    
                    // Load data for specific tabs
                    if (tabId === 'dashboard') {
                        loadSessions();
                        startAutoRefresh();
                    } else {
                        stopAutoRefresh();
                    }
                } else {
                    content.classList.add('hidden');
                }
            });
            
            // Close mobile menu
            elements.mobileMenu.classList.add('hidden');
        }

        // Load active sessions
        async function loadSessions() {
            try {
                state.isLoading = true;
                showLoader(elements.sessionsTableBody);
                
                const response = await fetch('/sessions');
                const data = await response.json();
                
                state.activeSessions = data;
                updateDashboardStats();
                renderSessionsTable();
                
                state.isLoading = false;
            } catch (error) {
                showToast('Error loading sessions: ' + error.message, 'error');
                state.isLoading = false;
            }
        }

        // Show loader in table
        function showLoader(container) {
            container.innerHTML = `
                <tr>
                    <td colspan="4" class="text-center py-8">
                        <div class="flex flex-col items-center">
                            <div class="loader mb-3"></div>
                            <div class="text-[#a0a0a0]">Loading sessions...</div>
                        </div>
                    </td>
                </tr>
            `;
        }

        // Render sessions table
        function renderSessionsTable() {
            const { activeSessions } = state;
            
            if (activeSessions.length === 0) {
                elements.sessionsTableContainer.classList.add('hidden');
                elements.noSessionsMessage.classList.remove('hidden');
                return;
            }
            
            elements.sessionsTableContainer.classList.remove('hidden');
            elements.noSessionsMessage.classList.add('hidden');
            
            // Clear table
            elements.sessionsTableBody.innerHTML = '';
            
            // Add session rows
            activeSessions.forEach(session => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-[#0c0c0c] transition-colors';
                row.setAttribute('data-session-id', session.sessionId);
                
                // URL cell
                const urlCell = document.createElement('td');
                urlCell.className = 'px-3 py-3 border-b border-[#2a2a2a]';
                urlCell.innerHTML = `
                    <div class="max-w-xs overflow-hidden text-ellipsis">
                        ${session.url}
                    </div>
                `;
                
                // Progress cell
                const progressCell = document.createElement('td');
                progressCell.className = 'px-3 py-3 border-b border-[#2a2a2a]';
                progressCell.innerHTML = `
                    <div class="w-full h-2 bg-[#2a2a2a] rounded-full overflow-hidden">
                        <div class="h-full bg-[#4d6dd3] transition-all duration-300" style="width: ${session.progress}%"></div>
                    </div>
                    <div class="mt-1 text-sm">
                        ${session.count} / ${session.target} (${session.progress}%)
                    </div>
                `;
                
                // Status cell
                const statusCell = document.createElement('td');
                statusCell.className = 'px-3 py-3 border-b border-[#2a2a2a]';
                
                // Status badge styles based on status
                let badgeClasses = 'inline-flex items-center px-2 py-1 rounded text-sm font-medium';
                let badgeBgColor = '';
                let badgeTextColor = '';
                
                switch(session.status.toLowerCase()) {
                    case 'active':
                        badgeBgColor = 'bg-[#48c774] bg-opacity-20';
                        badgeTextColor = 'text-[#48c774]';
                        break;
                    case 'completed':
                        badgeBgColor = 'bg-[#48c774] bg-opacity-20';
                        badgeTextColor = 'text-[#48c774]';
                        break;
                    case 'stopped':
                        badgeBgColor = 'bg-[#ffdd57] bg-opacity-20';
                        badgeTextColor = 'text-[#ffdd57]';
                        break;
                    case 'error':
                        badgeBgColor = 'bg-[#f14668] bg-opacity-20';
                        badgeTextColor = 'text-[#f14668]';
                        break;
                }
                
                statusCell.innerHTML = `
                    <span class="${badgeClasses} ${badgeBgColor} ${badgeTextColor}">
                        ${getStatusIcon(session.status)} ${session.status}
                    </span>
                `;
                
                // Actions cell
                const actionsCell = document.createElement('td');
                actionsCell.className = 'px-3 py-3 border-b border-[#2a2a2a]';
                actionsCell.innerHTML = `
                    <div class="flex gap-2">
                        <button class="view-session flex items-center justify-center w-9 h-9 bg-[#0c0c0c] text-[#a0a0a0] hover:text-white rounded-md transition-colors elevation-1">
                            <i class="ph-fill ph-eye"></i>
                        </button>
                        <button class="stop-session flex items-center justify-center w-9 h-9 bg-[#f14668] text-white rounded-md hover:opacity-90 transition-opacity elevation-1 ${session.status.toLowerCase() !== 'active' ? 'opacity-50 cursor-not-allowed' : ''}">
                            <i class="ph-fill ph-stop-circle"></i>
                        </button>
                    </div>
                `;
                
                // Append cells to row
                row.appendChild(urlCell);
                row.appendChild(progressCell);
                row.appendChild(statusCell);
                row.appendChild(actionsCell);
                
                // Add row to table
                elements.sessionsTableBody.appendChild(row);
                
                // Add event listeners
                const viewButton = row.querySelector('.view-session');
                viewButton.addEventListener('click', () => showSessionDetails(session.sessionId));
                
                const stopButton = row.querySelector('.stop-session');
                if (session.status.toLowerCase() === 'active') {
                    stopButton.addEventListener('click', () => stopSession(session.sessionId));
                }
                
                // Make entire row clickable
                row.addEventListener('click', (e) => {
                    // Don't trigger if clicking on buttons
                    if (!e.target.closest('button')) {
                        showSessionDetails(session.sessionId);
                    }
                });
            });
        }

        // Get status icon based on status
        function getStatusIcon(status) {
            const statusLower = status.toLowerCase();
            if (statusLower === 'active') {
                return '<i class="ph-fill ph-play"></i>';
            } else if (statusLower === 'completed') {
                return '<i class="ph-fill ph-check-circle"></i>';
            } else if (statusLower === 'stopped') {
                return '<i class="ph-fill ph-stop-circle"></i>';
            } else if (statusLower === 'error') {
                return '<i class="ph-fill ph-warning-circle"></i>';
            }
            return '<i class="ph-fill ph-question"></i>';
        }
        
        // Show session details
        function showSessionDetails(sessionId) {
            const session = state.activeSessions.find(s => s.sessionId === sessionId);
            
            if (!session) {
                showToast('Session not found', 'error');
                return;
            }
            
            // Update state
            state.selectedSessionId = sessionId;
            
            // Fill details
            elements.detailSessionId.textContent = session.sessionId;
            elements.detailUrl.textContent = session.url;
            elements.detailPostId.textContent = session.postId || 'N/A';
            elements.detailStartTime.textContent = new Date(session.startTime).toLocaleString();
            elements.detailEndTime.textContent = session.estimatedEndTime ? new Date(session.estimatedEndTime).toLocaleString() : 'N/A';
            
            // Status with badge
            let badgeClasses = 'inline-flex items-center px-2 py-1 rounded text-sm font-medium';
            let badgeBgColor = '';
            let badgeTextColor = '';
            
            switch(session.status.toLowerCase()) {
                case 'active':
                    badgeBgColor = 'bg-[#48c774] bg-opacity-20';
                    badgeTextColor = 'text-[#48c774]';
                    break;
                case 'completed':
                    badgeBgColor = 'bg-[#48c774] bg-opacity-20';
                    badgeTextColor = 'text-[#48c774]';
                    break;
                case 'stopped':
                    badgeBgColor = 'bg-[#ffdd57] bg-opacity-20';
                    badgeTextColor = 'text-[#ffdd57]';
                    break;
                case 'error':
                    badgeBgColor = 'bg-[#f14668] bg-opacity-20';
                    badgeTextColor = 'text-[#f14668]';
                    break;
            }
            
            elements.detailStatus.innerHTML = `
                <span class="${badgeClasses} ${badgeBgColor} ${badgeTextColor}">
                    ${getStatusIcon(session.status)} ${session.status}
                </span>
            `;
            
            // Progress with bar
            elements.detailProgress.innerHTML = `
                <div class="w-full h-2 bg-[#2a2a2a] rounded-full overflow-hidden mt-1">
                    <div class="h-full bg-[#4d6dd3] transition-all duration-300" style="width: ${session.progress}%"></div>
                </div>
                <div class="mt-1 text-sm">
                    ${session.count} / ${session.target} (${session.progress}%)
                </div>
            `;
            
            // Show details panel with animation
            elements.sessionDetails.classList.remove('hidden');
            elements.sessionDetails.style.animation = 'fadeIn 0.3s ease-out forwards';
            
            // Update stop button state
            if (session.status.toLowerCase() === 'active') {
                elements.stopSessionBtn.classList.remove('hidden');
            } else {
                elements.stopSessionBtn.classList.add('hidden');
            }
        }
        
        // Update dashboard statistics
        function updateDashboardStats() {
            const { activeSessions } = state;
            
            // Count active, completed, and error sessions
            let activeCount = 0;
            let completedCount = 0;
            let errorCount = 0;
            let totalShares = 0;
            
            activeSessions.forEach(session => {
                totalShares += session.count;
                
                if (session.status.toLowerCase() === 'active') {
                    activeCount++;
                } else if (session.status.toLowerCase() === 'completed') {
                    completedCount++;
                } else if (session.status.toLowerCase() === 'error') {
                    errorCount++;
                }
            });
            
            // Update counters with animation
            animateCounter(elements.activeSessionsCount, activeCount);
            animateCounter(elements.totalSharesCount, totalShares);
            animateCounter(elements.completedSessionsCount, completedCount);
            animateCounter(elements.errorSessionsCount, errorCount);
        }
        
        // Animate counter
        function animateCounter(element, targetValue) {
            const currentValue = parseInt(element.textContent) || 0;
            const diff = targetValue - currentValue;
            
            if (diff === 0) return;
            
            const duration = 500; // ms
            const steps = 20;
            const stepValue = diff / steps;
            let currentStep = 0;
            
            const interval = setInterval(() => {
                currentStep++;
                const newValue = Math.round(currentValue + (stepValue * currentStep));
                
                if (currentStep >= steps) {
                    clearInterval(interval);
                    element.textContent = targetValue;
                } else {
                    element.textContent = newValue;
                }
            }, duration / steps);
        }
        
        // Filter sessions based on search term
        function filterSessions(searchTerm) {
            if (!searchTerm) {
                renderSessionsTable();
                return;
            }
            
            const searchLower = searchTerm.toLowerCase();
            const filtered = state.activeSessions.filter(session => 
                session.url.toLowerCase().includes(searchLower) || 
                session.sessionId.toLowerCase().includes(searchLower) ||
                (session.postId && session.postId.toString().includes(searchLower))
            );
            
            // Temporarily update state for rendering
            const originalSessions = state.activeSessions;
            state.activeSessions = filtered;
            renderSessionsTable();
            state.activeSessions = originalSessions;
        }
        
        // Stop a session
        async function stopSession(sessionId) {
            try {
                const response = await fetch('/api/stop', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ sessionId })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Failed to stop session');
                }
                
                showToast('Session stopped successfully', 'success');
                loadSessions();
                
                // Close details panel if it's the current session
                if (state.selectedSessionId === sessionId) {
                    closeSessionDetails();
                }
            } catch (error) {
                showToast('Error stopping session: ' + error.message, 'error');
            }
        }
        
        // Close session details panel
        function closeSessionDetails() {
            elements.sessionDetails.style.animation = 'fadeOut 0.3s ease-out forwards';
            setTimeout(() => {
                elements.sessionDetails.classList.add('hidden');
                elements.sessionDetails.style.animation = '';
                state.selectedSessionId = null;
            }, 300);
        }
        
        // Start a new sharing session
        async function startNewSession() {
            try {
                // Disable form
                elements.startSharingBtn.disabled = true;
                elements.startSharingBtn.innerHTML = '<div class="loader mr-2"></div> Starting...';
                
                // Get form values
                const url = elements.fbUrl.value;
                const cookie = elements.fbCookie.value;
                const amount = parseInt(elements.shareAmount.value);
                const interval = parseInt(elements.shareInterval.value);
                
                // Validate input
                if (!url || !url.includes('facebook.com')) {
                    throw new Error('Please enter a valid Facebook URL');
                }
                
                if (!cookie) {
                    throw new Error('Please enter your Facebook cookies');
                }
                
                if (isNaN(amount) || amount < 1) {
                    throw new Error('Please enter a valid number of shares');
                }
                
                if (isNaN(interval) || interval < 5) {
                    throw new Error('Interval must be at least 5 seconds');
                }
                
                // Send request
                const response = await fetch('/api/share', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        url,
                        cookie,
                        amount,
                        interval
                    })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Failed to start sharing session');
                }
                
                const result = await response.json();
                
                // Show success message
                showToast('Sharing session started successfully!', 'success');
                
                // Reset form
                elements.shareForm.reset();
                
                // Switch to dashboard tab
                activateTab('dashboard');
                
            } catch (error) {
                showToast('Error: ' + error.message, 'error');
            } finally {
                // Re-enable form
                elements.startSharingBtn.disabled = false;
                elements.startSharingBtn.innerHTML = '<i class="ph-fill ph-play mr-1"></i> Start Sharing';
            }
        }
        
        // Show toast notification
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `flex items-start gap-2 p-4 rounded-md ${type === 'success' ? 'bg-[#48c774]' : 'bg-[#f14668]'} text-white elevation-2`;
            toast.style.animation = 'slideIn 0.3s ease-out forwards';
            
            const icon = type === 'success' 
                ? '<i class="ph-fill ph-check-circle text-xl"></i>' 
                : '<i class="ph-fill ph-x-circle text-xl"></i>';
            
            toast.innerHTML = `
                <div class="flex-grow flex items-start gap-2">
                    ${icon}
                    <div class="mt-px">${message}</div>
                </div>
                <button class="text-white opacity-70 hover:opacity-100 transition-opacity">
                    <i class="ph-fill ph-x"></i>
                </button>
            `;
            
            elements.toasts.appendChild(toast);
            
            // Add event listener to close button
            const closeButton = toast.querySelector('button');
            closeButton.addEventListener('click', () => {
                toast.style.animation = 'fadeOut 0.3s ease-out forwards';
                setTimeout(() => {
                    if (elements.toasts.contains(toast)) {
                        elements.toasts.removeChild(toast);
                    }
                }, 300);
            });
            
            // Auto-close after 5 seconds
            setTimeout(() => {
                if (elements.toasts.contains(toast)) {
                    toast.style.animation = 'fadeOut 0.3s ease-out forwards';
                    setTimeout(() => {
                        if (elements.toasts.contains(toast)) {
                            elements.toasts.removeChild(toast);
                        }
                    }, 300);
                }
            }, 5000);
        }
        
        // Auto-refresh dashboard
        function startAutoRefresh() {
            if (state.refreshInterval) {
                clearInterval(state.refreshInterval);
            }
            
            state.refreshInterval = setInterval(() => {
                if (!state.isLoading) {
                    loadSessions();
                }
            }, 10000);
        }
        
        // Stop auto-refresh
        function stopAutoRefresh() {
            if (state.refreshInterval) {
                clearInterval(state.refreshInterval);
                state.refreshInterval = null;
            }
        }
        
        // Search history
        async function searchHistory() {
            try {
                const searchTerm = elements.historySearch.value;
                
                if (!searchTerm) {
                    showToast('Please enter a search term', 'error');
                    return;
                }
                
                // Show loading state
                elements.historyResults.innerHTML = `
                    <div class="flex flex-col items-center justify-center py-12">
                        <div class="loader mb-4"></div>
                        <div class="text-[#a0a0a0]">Searching...</div>
                    </div>
                `;
                
                const response = await fetch(`/api/search?term=${encodeURIComponent(searchTerm)}`);
                const data = await response.json();
                
                renderHistoryResults(data);
            } catch (error) {
                showToast('Error searching history: ' + error.message, 'error');
            }
        }
        
        // Render history search results
        function renderHistoryResults(data) {
            const { results, count, term } = data;
            
            if (count === 0) {
                elements.historyResults.innerHTML = `
                    <div class="flex flex-col items-center justify-center py-12 text-center">
                        <div class="w-16 h-16 flex items-center justify-center bg-[#0c0c0c] rounded-full mb-6 elevation-1">
                            <i class="ph-fill ph-magnifying-glass text-2xl text-[#606060]"></i>
                        </div>
                        <p class="text-[#a0a0a0]">No results found for "${term}"</p>
                    </div>
                `;
                return;
            }
            
            // Render results table
            let html = `
                <div class="mb-4">Found ${count} result(s) for "${term}"</div>
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse">
                        <thead>
                            <tr>
                                <th class="px-3 py-3 text-left text-[#a0a0a0] font-medium border-b border-[#2a2a2a]">Post URL</th>
                                <th class="px-3 py-3 text-left text-[#a0a0a0] font-medium border-b border-[#2a2a2a]">Progress</th>
                                <th class="px-3 py-3 text-left text-[#a0a0a0] font-medium border-b border-[#2a2a2a]">Status</th>
                                <th class="px-3 py-3 text-left text-[#a0a0a0] font-medium border-b border-[#2a2a2a]">Start Time</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            results.forEach(session => {
                // Status badge styles
                let badgeClasses = 'inline-flex items-center px-2 py-1 rounded text-sm font-medium';
                let badgeBgColor = '';
                let badgeTextColor = '';
                
                switch(session.status.toLowerCase()) {
                    case 'active':
                        badgeBgColor = 'bg-[#48c774] bg-opacity-20';
                        badgeTextColor = 'text-[#48c774]';
                        break;
                    case 'completed':
                        badgeBgColor = 'bg-[#48c774] bg-opacity-20';
                        badgeTextColor = 'text-[#48c774]';
                        break;
                    case 'stopped':
                        badgeBgColor = 'bg-[#ffdd57] bg-opacity-20';
                        badgeTextColor = 'text-[#ffdd57]';
                        break;
                    case 'error':
                        badgeBgColor = 'bg-[#f14668] bg-opacity-20';
                        badgeTextColor = 'text-[#f14668]';
                        break;
                }
                
                html += `
                    <tr class="hover:bg-[#0c0c0c] transition-colors">
                        <td class="px-3 py-3 border-b border-[#2a2a2a]">
                            <div class="max-w-xs overflow-hidden text-ellipsis">
                                ${session.url}
                            </div>
                        </td>
                        <td class="px-3 py-3 border-b border-[#2a2a2a]">
                            <div class="w-full h-2 bg-[#2a2a2a] rounded-full overflow-hidden">
                                <div class="h-full bg-[#4d6dd3] transition-all duration-300" style="width: ${session.progress}%"></div>
                            </div>
                            <div class="mt-1 text-sm">
                                ${session.count} / ${session.target} (${session.progress}%)
                            </div>
                        </td>
                        <td class="px-3 py-3 border-b border-[#2a2a2a]">
                            <span class="${badgeClasses} ${badgeBgColor} ${badgeTextColor}">
                                ${getStatusIcon(session.status)} ${session.status}
                            </span>
                        </td>
                        <td class="px-3 py-3 border-b border-[#2a2a2a]">
                            ${new Date(session.startTime).toLocaleString()}
                        </td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
            `;
            
            elements.historyResults.innerHTML = html;
        }
        
        // Helper function for debouncing
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
        
        // Initialize app
        function init() {
            // Tab navigation
            elements.navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const tabId = link.getAttribute('data-tab');
                    activateTab(tabId);
                });
            });
            
            // Mobile menu toggle
            elements.menuToggle.addEventListener('click', () => {
                elements.mobileMenu.classList.toggle('hidden');
            });
            
            // Create first session button
            elements.createFirstSession.addEventListener('click', () => {
                activateTab('new-session');
            });
            
            // Refresh sessions button
            elements.refreshSessions.addEventListener('click', () => {
                loadSessions();
            });
            
            // Session search
            elements.sessionSearch.addEventListener('input', debounce(() => {
                filterSessions(elements.sessionSearch.value);
            }, 300));
            
            // Share form submission
            elements.shareForm.addEventListener('submit', (e) => {
                e.preventDefault();
                startNewSession();
            });
            
            // Close session details
            elements.closeDetailBtn.addEventListener('click', closeSessionDetails);
            
            // Stop session
            elements.stopSessionBtn.addEventListener('click', () => {
                if (state.selectedSessionId) {
                    stopSession(state.selectedSessionId);
                }
            });
            
            // Search history
            elements.searchHistoryBtn.addEventListener('click', () => {
                searchHistory();
            });
            
            elements.historySearch.addEventListener('keyup', (e) => {
                if (e.key === 'Enter') {
                    searchHistory();
                }
            });
            
            // Initial load
            activateTab('dashboard');
        }
        
        // Start the app
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
